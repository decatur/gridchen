<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>module name</title>
    <link id="favicon" rel="shortcut icon" type="image/png" href="yellow.png">
    <script src="../../theme.js"></script>
</head>
<body>
<h1><a href="../../index.html">Index</a> / Running Unit Test <span id="moduleName"/></h1>
<p>
    Open JavaScript console for details
</p>

</body>

<script type="module">
    import {getErrorCount, execute, log} from './utils.js'

    const favLink = document.getElementById('favicon');
    const params = new URLSearchParams(window.location.search);
    if (!params.has('module')) {
        throw new Error('Page must be loaded with module query');
    }
    const moduleName = params.get('module');
    document.title = moduleName;
    document.getElementById('moduleName').textContent = moduleName;

    import(`../${moduleName}.js`)
        .then(function () {
            return execute(params.get('test'))
        })
        .then(() => favLink.setAttribute('href', `${getErrorCount() ? 'red' : 'green'}.png`))
        .catch(function (reason) {
            favLink.setAttribute('href', `red.png`);
            console.error(reason);
            log(reason);
        })
        .then(function () {
            if (window.opener) {
                window.opener.moduleDone(moduleName);
            }
        });

</script>
</html>